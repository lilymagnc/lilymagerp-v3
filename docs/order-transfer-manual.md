# 주문이관 관리 시스템 사용자 메뉴얼

## 📋 목차
1. [주문이관 개요](#주문이관-개요)
2. [주문이관 프로세스](#주문이관-프로세스)
3. [주문이관 관리 화면](#주문이관-관리-화면)
4. [통계 카드 설명](#통계-카드-설명)
5. [상태별 관리 방법](#상태별-관리-방법)
6. [자동 동기화 기능](#자동-동기화-기능)
7. [권한별 기능](#권한별-기능)
8. [자주 묻는 질문](#자주-묻는-질문)

---

## 🎯 주문이관 개요

### 주문이관이란?
- 한 지점에서 받은 주문을 다른 지점에서 처리하도록 이관하는 기능
- 재고 부족, 인력 부족, 지역적 특성 등으로 인해 발생하는 상황에 대응
- 발주지점(이관 요청하는 지점)과 수주지점(이관 받는 지점)으로 구분

### 주요 용어
- **발주지점**: 이관을 요청하는 지점 (원본 주문 지점)
- **수주지점**: 이관을 받아서 처리하는 지점
- **이관 상태**: 대기중 → 수락됨 → 완료됨 (또는 거절됨/취소됨)
- **금액 분배**: 발주지점과 수주지점 간의 매출 분배 비율

---

## 🔄 주문이관 프로세스

### 1단계: 이관 요청
1. 발주지점에서 주문 관리 → 주문 선택
2. "주문 이관" 버튼 클릭
3. 수주지점 선택
4. 이관 사유 입력
5. 금액 분배 비율 설정
6. 이관 요청 완료

### 2단계: 이관 수락/거절
1. 수주지점에서 주문이관 관리 화면 접속
2. "대기중" 상태의 이관 요청 확인
3. 상세 내용 검토 후 수락 또는 거절
4. 수락 시: 주문이 수주지점으로 이관됨
5. 거절 시: 이관 요청이 거절됨

### 3단계: 주문 처리 및 완료
1. 수주지점에서 이관받은 주문 처리
2. 주문 완료 처리 시 **자동으로 이관 상태도 완료됨**
3. 발주지점의 원본 주문도 자동으로 완료 상태로 변경

---

## 📊 주문이관 관리 화면

### 메인 화면 구성
- **통계 카드**: 전체 현황을 한눈에 파악
- **필터 기능**: 상태, 지점, 날짜별 검색
- **이관 내역 테이블**: 상세 이관 정보 표시
- **작업 버튼**: 상태 변경, 상세보기, 삭제 등

### 필터 사용법
1. **검색**: 주문ID, 지점명, 사유로 검색
2. **상태 필터**: 전체/대기중/수락됨/거절됨/완료됨/취소됨
3. **지점 필터**: 발주지점, 수주지점별 필터링 (본사 관리자만)
4. **날짜 필터**: 이관 요청 날짜 범위 설정

---

## 📈 통계 카드 설명

### 기본 통계 카드
1. **총 이관**: 전체 이관 요청 건수
2. **대기중**: 수락/거절 대기 중인 건수
3. **수락됨**: 수락되어 처리 중인 건수
4. **거절됨**: 거절된 이관 건수
5. **완료됨**: ✅ **새로 추가된 기능** - 완료된 이관 건수
6. **취소됨**: 발주지점에서 취소한 건수
7. **총 금액**: 이관된 주문들의 총 금액

### 지점별 통계 카드 (일반 사용자)
1. **발주 이관**: 내 지점에서 다른 지점으로 이관한 건수
2. **수주 이관**: 다른 지점에서 내 지점으로 이관받은 건수

---

## 🎛️ 상태별 관리 방법

### 대기중 (Pending)
- **발주지점**: 취소 가능, 상세보기 가능
- **수주지점**: 수락/거절 가능, 상세보기 가능
- **본사 관리자**: 모든 작업 가능

### 수락됨 (Accepted)
- **수주지점**: 주문 처리 진행
- **발주지점**: 처리 상황 모니터링
- **상태 변경**: 주문 완료 시 자동으로 "완료됨"으로 변경

### 완료됨 (Completed) ✅
- **자동 생성**: 수주지점에서 주문 완료 처리 시 자동 생성
- **동기화**: 발주지점 원본 주문도 자동 완료
- **통계 반영**: "완료됨" 카드에 즉시 반영

### 거절됨 (Rejected)
- **종료 상태**: 추가 작업 불가
- **사유 확인**: 거절 사유 확인 가능

### 취소됨 (Cancelled)
- **발주지점**: 대기중 상태에서만 취소 가능
- **종료 상태**: 추가 작업 불가

---

## ⚡ 자동 동기화 기능

### 자동 완료 처리
1. **수주지점에서 주문 완료** → 이관 상태 자동 "완료됨"
2. **발주지점 원본 주문** → 자동으로 "완료" 상태로 변경
3. **통계 업데이트** → "완료됨" 카드에 즉시 반영

### 동기화 대상
- 이관 기록의 상태
- 원본 주문의 상태
- 완료 시간 및 처리자 정보
- 통계 데이터

### 오류 처리
- 동기화 실패 시에도 주문 완료 처리는 계속 진행
- 오류 로그는 콘솔에 기록되며 사용자에게는 투명하게 처리

---

## 🔐 권한별 기능

### 본사 관리자
- **모든 지점** 이관 내역 조회
- **모든 상태** 변경 가능
- **이관 기록 삭제** 가능
- **고아 기록 정리** 기능 사용 가능
- **전체 통계** 확인 가능

### 가맹점 관리자
- **자신의 지점** 관련 이관만 조회
- **발주/수주 이관** 구분하여 표시
- **권한에 따른** 상태 변경 가능
- **자신의 지점** 이관 기록 삭제 가능

### 일반 사용자
- **자신의 지점** 관련 이관만 조회
- **읽기 전용** 또는 **제한된 권한**
- **상태 변경** 권한 없음

---

## ❓ 자주 묻는 질문

### Q1: 이관 요청 후 언제까지 취소할 수 있나요?
**A**: 수주지점에서 수락하기 전까지 취소 가능합니다. 수락 후에는 취소할 수 없습니다.

### Q2: 이관된 주문의 매출은 어느 지점에 반영되나요?
**A**: 설정한 금액 분배 비율에 따라 발주지점과 수주지점에 분배되어 반영됩니다.

### Q3: 수주지점에서 주문을 완료하면 발주지점은 어떻게 되나요?
**A**: ✅ **자동으로 발주지점의 원본 주문도 완료 상태로 변경됩니다.**

### Q4: 이관 상태가 "완료됨"으로 자동 변경되는 시점은 언제인가요?
**A**: 수주지점에서 주문 상태를 "완료"로 변경하는 순간 자동으로 이관 상태도 "완료됨"으로 변경됩니다.

### Q5: 이관 기록을 삭제할 수 있나요?
**A**: 본사 관리자와 해당 지점의 가맹점 관리자만 삭제 가능합니다. 삭제 시 관련된 모든 데이터가 함께 삭제됩니다.

### Q6: "완료됨" 통계 카드는 언제 업데이트되나요?
**A**: 주문 완료 처리와 동시에 실시간으로 업데이트됩니다. 별도 새로고침이 필요하지 않습니다.

### Q7: 이관 요청을 거절하면 어떻게 되나요?
**A**: 거절된 이관은 종료 상태가 되며, 발주지점에서 새로운 이관 요청을 해야 합니다.

### Q8: 여러 지점으로 동시에 이관할 수 있나요?
**A**: 현재는 한 번에 하나의 지점으로만 이관 가능합니다. 여러 지점 이관이 필요한 경우 개별적으로 요청해야 합니다.

---

## 📞 지원 및 문의

### 기술 지원
- 시스템 오류 발생 시 본사 관리자에게 문의
- 로그 확인을 위해 브라우저 개발자 도구 콘솔 확인

### 업무 지원
- 이관 프로세스 관련 문의는 각 지점 관리자에게 문의
- 권한 관련 문의는 본사 관리자에게 문의

---

## 🔄 최근 업데이트 (v3.0)

### 새로운 기능
- ✅ **자동 완료 동기화**: 수주지점 완료 시 발주지점 자동 완료
- ✅ **완료됨 통계 카드**: 완료된 이관 건수 실시간 표시
- ✅ **개선된 상태 표시**: 완료 상태를 초록색으로 구분
- ✅ **실시간 통계 업데이트**: 별도 새로고침 없이 즉시 반영

### 개선사항
- 이관 상태와 주문 상태의 자동 동기화
- 사용자 경험 향상을 위한 시각적 개선
- 데이터 정확성 및 무결성 보장

---

*이 메뉴얼은 주문이관 관리 시스템의 모든 기능을 포함하고 있습니다. 추가 문의사항이 있으시면 관리자에게 문의해 주세요.*
